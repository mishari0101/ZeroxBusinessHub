<div class="dashboard-wrapper">
  
  <!-- LEFT: STICKY PROFILE PANEL -->
  <aside class="profile-sidebar">
    <div class="profile-card">
      <div class="card-header-gradient"></div>
      
      <div class="profile-body text-center">
        
        <!-- PROFILE IMAGE (With Edit Overlay) -->
        <div class="avatar-container" (click)="isEditing && fileInput.click()" [class.editable]="isEditing">
          <img [src]="previewImage || 'assets/img/placeholder-profile.jpg'" class="avatar-img">
          
          <div class="overlay" *ngIf="isEditing">
             <i class="bi bi-camera-fill"></i>
          </div>
        </div>
        
        <!-- Hidden Input -->
        <input #fileInput type="file" (change)="onFileSelected($event)" hidden accept="image/*">

        <h3 class="mt-3 fw-bold">{{ userProfile.fullName || 'User' }}</h3>
        <p class="text-muted small">Customer Account</p>

        <!-- READ MODE -->
        <div *ngIf="!isEditing" class="info-list mt-4 text-start">
          <div class="info-item">
            <span class="label">Phone</span>
            <span class="value">{{ userProfile.phoneNumber || 'Not set' }}</span>
          </div>
          <div class="info-item">
            <span class="label">District</span>
            <span class="value">{{ userProfile.district || 'Not set' }}</span>
          </div>
          
          <button class="btn btn-outline-purple w-100 mt-4" (click)="toggleEdit()">
            <i class="bi bi-pencil-square"></i> Edit Profile
          </button>
        </div>

        <!-- EDIT MODE -->
        <div *ngIf="isEditing" class="edit-form mt-4 text-start fade-in">
          <div class="mb-3">
            <label>Full Name</label>
            <input class="form-control" [(ngModel)]="userProfile.fullName">
          </div>
          <div class="mb-3">
            <label>Phone Number</label>
            <input class="form-control" [(ngModel)]="userProfile.phoneNumber">
          </div>
          <div class="mb-3">
            <label>District</label>
            <input class="form-control" [(ngModel)]="userProfile.district">
          </div>
          
          <div class="d-flex gap-2">
            <button class="btn btn-secondary flex-grow-1" (click)="toggleEdit()">Cancel</button>
            <button class="btn btn-purple flex-grow-1" (click)="saveProfile()">Save</button>
          </div>
        </div>

      </div>
    </div>
  </aside>

  <!-- RIGHT: SCROLLABLE BOOKINGS -->
  <main class="bookings-content">
    <div class="content-container">
      <h3 class="section-title">My Bookings</h3>

      <!-- Loading -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-purple"></div>
        <p class="text-muted mt-2">Loading bookings...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && bookings.length === 0" class="empty-state">
        <div class="empty-icon">ðŸ“…</div>
        <h4>No Bookings Yet</h4>
        <p>Go explore services and book your first appointment!</p>
        <a routerLink="/" class="btn btn-purple mt-3">Browse Services</a>
      </div>

      <!-- Booking List -->
      <div class="booking-list" *ngIf="!isLoading && bookings.length > 0">
        <div class="booking-card fade-in" *ngFor="let b of bookings">
          
          <!-- ðŸ”¥ SERVICE IMAGE -->
          <div class="service-img" [style.backgroundImage]="'url(' + b.serviceImg + ')'"></div>

          <div class="booking-info flex-grow-1">
            <h5>{{ b.serviceName }}</h5>
            <p class="mb-1 text-muted small">
              <i class="bi bi-shop"></i> {{ b.businessName }}
            </p>
            <p class="mb-0 text-muted small">
               <i class="bi bi-clock"></i> {{ b.bookingTimeSlot | date:'medium' }}
            </p>
          </div>

          <div class="booking-status text-end">
            <span class="price-tag">${{ b.price }}</span>
            
            <div *ngIf="b.status === 'Accepted'" class="status-success">
              <i class="bi bi-check-circle-fill"></i> Order Confirmed
            </div>
            <div *ngIf="b.status === 'Pending'" class="status-pending">
              <i class="bi bi-hourglass-split"></i> Waiting for Confirmation
            </div>
            <div *ngIf="b.status === 'Declined'" class="status-danger">
              <i class="bi bi-x-circle-fill"></i> Order Declined
            </div>
          </div>

        </div>
      </div>

    </div>
  </main>

</div>