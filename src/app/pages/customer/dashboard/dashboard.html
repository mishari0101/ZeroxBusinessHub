<div class="dashboard-wrapper">
  
  <!-- LEFT: STICKY PROFILE PANEL -->
  <aside class="profile-sidebar">
    <div class="profile-card">
      <div class="card-header-gradient"></div>
      
      <div class="profile-body text-center">
        
        <!-- PROFILE IMAGE (With Edit Overlay) -->
        <div class="avatar-container" (click)="isEditing && fileInput.click()" [class.editable]="isEditing">
          <img [src]="previewImage || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="avatar-img">
          
          <div class="overlay" *ngIf="isEditing">
             <i class="bi bi-camera-fill"></i>
          </div>
        </div>
        
        <!-- ðŸ”¥ FIXED: Matches 'onFileSelected' in TS -->
        <input #fileInput type="file" (change)="onFileSelected($event)" hidden accept="image/*">

        <h3 class="mt-3 fw-bold">{{ userProfile.fullName || 'User' }}</h3>
        <p class="text-muted small">Customer Account</p>

        <!-- READ MODE -->
        <div *ngIf="!isEditing" class="info-list mt-4 text-start">
          <div class="info-item">
            <span class="label">Phone</span>
            <span class="value">{{ userProfile.phoneNumber || 'Not set' }}</span>
          </div>
          <div class="info-item">
            <span class="label">District</span>
            <span class="value">{{ userProfile.district || 'Not set' }}</span>
          </div>
          
          <button class="btn btn-outline-purple w-100 mt-4" (click)="toggleEdit()">
            <i class="bi bi-pencil-square"></i> Edit Profile
          </button>
        </div>

        <!-- EDIT MODE -->
        <div *ngIf="isEditing" class="edit-form mt-4 text-start fade-in">
          <div class="mb-3">
            <label>Full Name</label>
            <input class="form-control" [(ngModel)]="userProfile.fullName">
          </div>
          <div class="mb-3">
            <label>Phone Number</label>
            <input class="form-control" [(ngModel)]="userProfile.phoneNumber">
          </div>
          <div class="mb-3">
            <label>District</label>
            <select class="form-select" [(ngModel)]="userProfile.district">
              <option *ngFor="let d of districts" [value]="d">{{ d }}</option>
            </select>
          </div>
          
          <div class="d-flex gap-2">
            <button class="btn btn-secondary flex-grow-1" (click)="toggleEdit()">Cancel</button>
            <button class="btn btn-purple flex-grow-1" (click)="saveProfile()">Save</button>
          </div>
        </div>

      </div>
    </div>
  </aside>

  <!-- RIGHT: SCROLLABLE BOOKINGS -->
  <main class="bookings-content">
    <div class="content-container">
      <h3 class="section-title">My Bookings</h3>

      <!-- Loading -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-purple"></div>
        <p class="text-muted mt-2">Loading bookings...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && bookings.length === 0" class="empty-state">
        <div class="empty-icon">ðŸ“…</div>
        <h4>No Bookings Yet</h4>
        <p>Go explore services and book your first appointment!</p>
        <a routerLink="/" class="btn btn-purple mt-3">Browse Services</a>
      </div>

      <!-- Booking List -->
      <div class="booking-list" *ngIf="!isLoading && bookings.length > 0">
        <div class="booking-card fade-in" *ngFor="let b of bookings">
          
          <!-- SERVICE IMAGE -->
          <div class="service-img" [style.backgroundImage]="'url(' + b.serviceImage + ')'"></div>

          <div class="booking-info flex-grow-1">
            <h5>{{ b.serviceName }}</h5>
            <p class="mb-1 text-muted small">
              <i class="bi bi-shop"></i> {{ b.businessName }}
            </p>
            <p class="mb-0 text-muted small">
               <i class="bi bi-clock"></i> {{ b.bookingTimeSlot | date:'medium' }}
            </p>
          </div>

          <!-- STATUS & CHAT AREA -->
          <div class="booking-status text-end d-flex flex-column align-items-end gap-2">
            
            <span class="price-tag">${{ b.price }}</span>
            
            <!-- Pending -->
            <div *ngIf="b.status === 'Pending'" class="status-pending">
              <i class="bi bi-hourglass-split"></i> Waiting for Confirmation
            </div>
            
            <!-- Declined -->
            <div *ngIf="b.status === 'Declined'" class="status-danger">
              <i class="bi bi-x-circle-fill"></i> Order Declined
            </div>

            <!-- Accepted/Completed -->
            <div *ngIf="b.status === 'Accepted' || b.status === 'Completed'" class="d-flex align-items-center gap-3">
              <span class="status-success"><i class="bi bi-check-circle-fill"></i> Order Confirmed</span>
              
              <!-- CHAT BUTTON -->
              <button class="btn-chat-customer" (click)="goToChat(b.id)" title="Chat with Provider">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 16 16">
                  <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                </svg>
              </button>
            </div>

          </div>

        </div>
      </div>

    </div>
  </main>

</div>